!function(i){"use strict";var p={initialize:function(){self=this,i("ul.erp-dashboard-announcement").on("click","a.mark-read",this.dashboard.markAnnouncementRead),i("ul.erp-dashboard-announcement").on("click","a.view-full",this.dashboard.viewAnnouncement),i("ul.erp-dashboard-announcement").on("click",".announcement-title a",this.dashboard.viewAnnouncementTitle),i("ul.erp-list").on("click",".send-wish",this.dashboard.sendBirthdayWish),i("body").on("click","a#erp-new-dept",this.department.create),i(".erp-hr-depts").on("click","a.submitdelete",this.department.remove),i(".erp-hr-depts").on("click","span.edit a",this.department.edit),i("body").on("click","a#erp-new-designation",this.designation.create),i(".erp-hr-designation").on("click","a.submitdelete",this.designation.remove),i(".erp-hr-designation").on("click","span.edit a",this.designation.edit),i(".erp-hr-employees").on("click","a#erp-employee-new",this.employee.create),i(".erp-hr-employees").on("click","span.edit a",this.employee.edit),i(".erp-hr-employees").on("click","a.submitdelete",this.employee.remove),i(".erp-hr-employees").on("click","a.submitrestore",this.employee.restore),i(".erp-hr-employees").on("click","a#erp-empl-type",this.employee.updateJobStatus),i(".erp-hr-employees").on("click","a#erp-empl-status",this.employee.updateJobStatus),i(".erp-hr-employees").on("click","a#erp-empl-compensation",this.employee.updateJobStatus),i(".erp-hr-employees").on("click","a#erp-empl-jobinfo",this.employee.updateJobStatus),i(".erp-hr-employees").on("click","td.action a.remove",this.employee.removeHistory),i(".erp-hr-employees").on("click","a#erp-employee-print",this.employee.printData),i("body").on("focusout","input#erp-hr-user-email",this.employee.checkUserEmail),i("body").on("click","a#erp-hr-create-wp-user-to-employee",this.employee.makeUserEmployee),i(".erp-employee-single").on("click","a#erp-employee-terminate",this.employee.terminateEmployee),i(".erp-employee-single").on("click","input#erp-hr-employee-status-update",this.employee.changeEmployeeStatus),i(".erp-hr-employees").on("click","a#erp-empl-performance-reviews",this.employee.updatePerformance),i(".erp-hr-employees").on("click","a#erp-empl-performance-comments",this.employee.updatePerformance),i(".erp-hr-employees").on("click","a#erp-empl-performance-goals",this.employee.updatePerformance),i(".erp-hr-employees").on("click",".performance-tab-wrap td.action a.performance-remove",this.employee.removePerformance),i(".erp-hr-employees").on("click","a#erp-empl-add-exp",this.employee.general.create),i(".erp-hr-employees").on("click","a.work-experience-edit",this.employee.general.create),i(".erp-hr-employees").on("click","a.work-experience-delete",this.employee.general.remove),i(".erp-hr-employees").on("click","a#erp-empl-add-education",this.employee.general.create),i(".erp-hr-employees").on("click","a.education-edit",this.employee.general.create),i(".erp-hr-employees").on("click","a.education-delete",this.employee.general.remove),i("body").on("change","#result_type",self,this.employee.general.selectResultType),i(".erp-hr-employees").on("click","a#erp-empl-add-dependent",this.employee.general.create),i(".erp-hr-employees").on("click","a.dependent-edit",this.employee.general.create),i(".erp-hr-employees").on("click","a.dependent-delete",this.employee.general.remove),i(".erp-hr-employees").on("submit",".note-tab-wrap form",this.employee.addNote),i(".erp-hr-employees").on("click",".note-tab-wrap input#erp-load-notes",this.employee.loadNotes),i(".erp-hr-employees").on("click",".note-tab-wrap a.delete_note",this.employee.deleteNote),i("body").on("click","a#erp-set-emp-photo",this.employee.setPhoto),i("body").on("click","a.erp-remove-photo",this.employee.removePhoto),i("body").on("erp-hr-after-new-dept",this.department.afterNew),i("body").on("erp-hr-after-new-desig",this.designation.afterNew),i("body").on("change",".wp-list-table",function(e){i('.wp-list-table tbody tr th input[type="checkbox"]').is(":checked")?(i(".tablenav .bulkactions").show(),i(".tablenav").css("clear","both"),i(".wperp-filter-dropdown").css("margin-top","-63px")):(i(".tablenav .bulkactions").hide(),i(".tablenav").css("clear","none"),i(".wperp-filter-dropdown").css("margin-top","-53px"))}),i("body").on("click",".wperp-filter-dropdown a",this.employee.toggleFilterDropdown),i("body").on("click",'input[name="hide_filter"]',function(e){e.preventDefault(),self.employee.toggleFilterDropdown()}),i("body").on("click",'input[name="reset_filter"]',function(e){e.preventDefault(),i("#filter_designation option:selected").prop("selected",!1),i("#filter_department option:selected").prop("selected",!1),i("#filter_employment_type option:selected").prop("selected",!1),i("input[name=filter_employee]").click()}),this.initTipTip()},initToggleCheckbox:function(){var r=!1;i("tbody").children().children(".check-column").find(":checkbox").click(function(e){if("undefined"==e.shiftKey)return!0;if(e.shiftKey){if(!r)return!0;checks=i(r).closest("form").find(":checkbox").filter(":visible:enabled"),first=checks.index(r),last=checks.index(this),checked=i(this).prop("checked"),0<first&&0<last&&first!=last&&(sliced=last>first?checks.slice(first,last):checks.slice(last,first),sliced.prop("checked",function(){return!!i(this).closest("tr").is(":visible")&&checked}))}var t=i(r=this).closest("tbody").find(":checkbox").filter(":visible:enabled").not(":checked");return i(this).closest("table").children("thead, tfoot").find(":checkbox").prop("checked",function(){return 0===t.length}),!0}),i("thead, tfoot").find(".check-column :checkbox").on("click.wp-toggle-checkboxes",function(e){var t=i(this),r=t.closest("table"),o=t.prop("checked"),n=e.shiftKey||t.data("wp-toggle");r.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!i(this).is(":hidden,:disabled")&&(n?!i(this).prop("checked"):!!o)}),r.children("thead,  tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!n&&!!o})})},initTipTip:function(){i(".erp-tips").tipTip({defaultPosition:"top",fadeIn:100,fadeOut:100})},requiredAlert:function(e){var t=0;if(i("edit"===e?"#erp-employee-edit form":"#erp-new-employee-popup form").find("input, select, textarea").each(function(){i(this).prop("required")&&""===i(this).val()&&t++}),t){var r=wpErpHr.required_field_notice.replace("{count}",t);swal("",r,"warning")}},initDateField:function(){i(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+100"})},reloadPage:function(){i(".erp-area-left").load(window.location.href+" #erp-area-left-inner",function(){i(".select2").select2()})},ajaxReq:function(e,t){wp.ajax.send({data:e,success:function(){p.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})},dashboard:{markAnnouncementRead:function(e){e.preventDefault();var t=i(this);t.closest("li").hasClass("unread")&&wp.ajax.send("erp_hr_announcement_mark_read",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){t.closest("li").removeClass("unread").addClass("read"),t.addClass("erp-hide")},error:function(e){alert(e)}})},viewAnnouncementTitle:function(e){e.preventDefault();var t=i(this).closest("li").find("a.view-full");wp.ajax.send("erp_hr_announcement_view",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){i.erpPopup({title:e.title,button:"",id:"erp-hr-announcement",content:"<p>"+e.content+"</p>",extraClass:"midium"}),t.closest("li").removeClass("unread"),t.siblings(".mark-read").addClass("erp-hide")},error:function(e){alert(e)}})},viewAnnouncement:function(e){e.preventDefault();var t=i(this);wp.ajax.send("erp_hr_announcement_view",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){i.erpPopup({title:e.title,button:"",id:"erp-hr-announcement",content:"<p>"+e.content+"</p>",extraClass:"midium"}),t.closest("li").removeClass("unread"),t.siblings(".mark-read").addClass("erp-hide")},error:function(e){alert(e)}})},sendBirthdayWish:function(e){e.preventDefault();var t=i(this);i(".wait").show(),t.find("i").hide(),wp.ajax.send("erp_hr_birthday_wish",{data:{employee_user_id:t.data("user_id"),_wpnonce:wpErpHr.nonce},success:function(e){i(".wait").hide(),alert(e)},error:function(e){alert(e)}})}},department:{afterNew:function(e,t){var r=i(".erp-hr-dept-drop-down");wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),r.append('<option selected="selected" value="'+t.id+'">'+t.title+"</option>"),r.select2().select2("val",t.id)},reload:function(){i("#erp-dept-table-wrap").load(window.location.href+" #erp-dept-table-wrap",function(){p.initToggleCheckbox()})},tempReload:function(){wperp.scriptReload("erp_hr_new_dept_tmp_reload","tmpl-erp-new-dept")},create:function(e){e.preventDefault();var r=i(this).data("single");i.erpPopup({title:wpErpHr.popup.dept_title,button:wpErpHr.popup.dept_submit,id:"erp-hr-new-department",content:wperp.template("erp-new-dept")().trim(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(e){p.department.reload(),"1"!=r?i("body").trigger("erp-hr-after-new-dept",[e]):p.department.tempReload(),t.closeModal()},error:function(e){t.showError(e)}})}})},edit:function(e){e.preventDefault();var r=i(this);i.erpPopup({title:wpErpHr.popup.dept_update,button:wpErpHr.popup.dept_update,id:"erp-hr-new-department",content:wp.template("erp-new-dept")().trim(),extraClass:"smaller",onReady:function(){var t=this;i("header",t).after(i('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-dept",{data:{id:r.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){i(".loader",t).remove(),i("#dept-title",t).val(e.name),i("#dept-desc",t).val(e.data.description),i("#dept-parent",t).val(e.data.parent),i("#dept-lead",t).val(e.data.lead),i("#dept-id",t).val(e.id),i("#dept-action",t).val("erp-hr-update-dept"),i('#dept-parent option[value="'+r.data("id")+'"]',t).attr("disabled","disabled")}})},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){p.department.reload(),p.department.tempReload(),t.closeModal()},error:function(e){t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=i(this);confirm(wpErpHr.delConfirmDept)&&wp.ajax.send("erp-hr-del-dept",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){i(this).remove(),p.department.tempReload()})},error:function(e){alert(e)}})}},designation:{afterNew:function(e,t){var r=i(".erp-hr-desi-drop-down");wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),r.append('<option selected="selected" value="'+t.id+'">'+t.title+"</option>"),p.employee.select2AddMoreActive("erp-hr-desi-drop-down"),r.select2("val",t.id)},reload:function(){i(".erp-hr-designation").load(window.location.href+" .erp-hr-designation",function(){p.initToggleCheckbox()})},create:function(e){e.preventDefault();var r=i(this).data("single");i.erpPopup({title:wpErpHr.popup.desig_title,button:wpErpHr.popup.desig_submit,id:"erp-hr-new-designation",content:wp.template("erp-new-desig")().trim(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(e){p.designation.reload(),"1"!=r&&i("body").trigger("erp-hr-after-new-desig",[e]),t.closeModal()},error:function(e){t.showError(e)}})}})},edit:function(e){e.preventDefault();var r=i(this);i.erpPopup({title:wpErpHr.popup.desig_update,button:wpErpHr.popup.desig_update,content:wp.template("erp-new-desig")().trim(),id:"erp-hr-new-designation",extraClass:"smaller",onReady:function(){var t=this;i("header",t).after(i('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-desig",{data:{id:r.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){i(".loader",t).remove(),i("#desig-title",t).val(e.name),i("#desig-desc",t).val(e.data.description),i("#desig-id",t).val(e.id),i("#desig-action",t).val("erp-hr-update-desig")}})},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){p.designation.reload(),t.closeModal()},error:function(e){t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=i(this);confirm(wpErpHr.delConfirmDept)&&wp.ajax.send("erp-hr-del-desig",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){i(this).remove()})},error:function(e){alert(e)}})}},employee:{reload:function(){i(".erp-hr-employees-wrap").load(window.location.href+" .erp-hr-employees-wrap-inner",function(){p.initToggleCheckbox()})},setPhoto:function(e){var t;e.preventDefault(),e.stopPropagation(),t||(t=wp.media({title:wpErpHr.emp_upload_photo,button:{text:wpErpHr.emp_set_photo}})).on("select",function(){t.state().get("selection").map(function(e){var t='<img src="'+(e=e.toJSON()).url+'" alt="" />';t+='<input type="hidden" id="emp-photo-id" name="personal[photo_id]" value="'+e.id+'" />',t+='<a href="#" class="erp-remove-photo">&times;</a>',i(".photo-container",".erp-employee-form").html(t)})}),t.open()},removePhoto:function(e){e.preventDefault();var t='<img src="'+(wpErpHr.asset_url+"/images/mystery-person.png")+'" alt="">';t+='<input type="hidden" name="personal[photo_id]" id="emp-photo-id" value="0">',t+='<a href="#" id="erp-set-emp-photo" class="button-primary"><i class="fa fa-cloud-upload"></i>'+wpErpHr.emp_upload_photo+"</a>",i(".photo-container",".erp-employee-form").html(t)},create:function(e){void 0!==e&&e.preventDefault(),void 0!==wpErpHr.employee_empty&&i.erpPopup({title:wpErpHr.popup.employee_title,button:wpErpHr.popup.employee_create,id:"erp-new-employee-popup",content:wperp.template("erp-new-employee")(wpErpHr.employee_empty).trim(),onReady:function(){p.initDateField(),i(".select2").select2(),p.employee.select2Action("erp-hrm-select2"),p.employee.select2AddMoreContent(),i("#user_notification").on("click",function(){i(this).is(":checked")?i(".show-if-notification").show():i(".show-if-notification").hide()}),i("#advanced_fields").click(function(){i(this).is(" :checked ")?(i(".employee-work").show(),i(".employee-personal").show()):(i(".employee-work").hide(),i(".employee-personal").hide())}),i("button[type=submit]").click(p.requiredAlert)},onSubmit:function(t){i("button[type=submit]",".erp-modal").attr("disabled","disabled"),wp.ajax.send("erp-hr-employee-new",{data:this.serialize(),success:function(e){t.enableButton(),t.closeModal(),void 0!==e.url&&(window.location.href=e.url)},error:function(e){t.enableButton(),t.showError(e)}})}})},select2AddMoreContent:function(){var e=i(".erp-hrm-select2-add-more");i.each(e,function(e,t){p.employee.select2AddMoreActive(t)})},select2AddMoreActive:function(e){var t=i(e).data("id"),r=i(e).data("add");void 0!==r&&0<r.length?i(e).select2().on("select2:open",function(){i(".select2-results:not(:has(a))").append('<div class="erp-select2-add"><a href="#" id="'+t+'">'+r+"</a></div>")}):i(e).select2({width:"element",language:{noResults:function(){return'<a href="#" class="button button-primary" id="'+t+'">Add New</a>'}},escapeMarkup:function(e){return e}})},select2Action:function(e){i("."+e).select2({width:"element"})},edit:function(e){e.preventDefault();var t=i(this);i.erpPopup({title:wpErpHr.popup.employee_update,button:wpErpHr.popup.employee_update,id:"erp-employee-edit",onReady:function(){var r=this;i("header",r).after(i('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-emp-get",{data:{id:t.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){var t=wp.template("erp-new-employee")(e);i(".content",r).html(t),i(".loader",r).remove(),p.initDateField(),i(".select2").select2(),p.employee.select2Action("erp-hrm-select2"),p.employee.select2AddMoreContent(),i("#advanced_fields").click(function(){i(this).is(" :checked ")?(i(".employee-work").show(),i(".employee-personal").show()):(i(".employee-work").hide(),i(".employee-personal").hide())}),i("div[data-selected]",r).each(function(){var e=i(this),r=0,o=e.data("selected"),n=i("span.checkbox input[type=checkbox][required]");""!==o&&(e.find("select").val(o).trigger("change"),e.find("input[type=radio][value='"+o+"']").prop("checked",!0),i.each(e.find("input[type=checkbox]"),function(e,t){-1!=i.inArray(i(t).val(),o.split(","))?i(t).prop("checked",!0):i.inArray(i(t),n)&&r++}),r!==n.length&&i.each(e.find("span.checkbox input[type=checkbox][required]"),function(e,t){-1==i.inArray(i(t).val(),o.split(","))&&i(t).removeAttr("required")}))}),i('#work_reporting_to option[value="'+e.id+'"]',r).attr("disabled","disabled")}}),i("button[type=submit]").click(function(){p.requiredAlert("edit")})},onSubmit:function(t){t.disableButton(),wp.ajax.send({data:this.serialize(),success:function(e){p.employee.reload(),t.enableButton(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=i(this);confirm(wpErpHr.delConfirmEmployee)&&wp.ajax.send("erp-hr-emp-delete",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id"),hard:t.data("hard")},success:function(){t.closest("tr").fadeOut("fast",function(){i(this).remove(),p.employee.reload()})},error:function(e){alert(e)}})},restore:function(e){e.preventDefault();var t=i(this);confirm(wpErpHr.restoreConfirmEmployee)&&wp.ajax.send("erp-hr-emp-restore",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){i(this).remove(),p.employee.reload()})},error:function(e){alert(e)}})},toggleFilterDropdown:function(){document.getElementById("erp-dropdown-content").classList.toggle("show")},general:{create:function(e){void 0!==e&&e.preventDefault();var t=i(this);i.erpPopup({title:t.data("title"),content:wp.template(t.data("template"))(t.data("data")),extraClass:"smaller",id:"erp-hr-new-general",button:t.data("button"),onReady:function(){p.initDateField(),i(".row[data-selected]",this).each(function(){var e=i(this),t=e.data("selected");""!==t&&e.find("select").val(t),"percentage"===t&&(i(".education-form-wrap #scale").removeAttr("required"),i(".education-form-wrap #result_scale").fadeOut())})},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){p.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=i(this);confirm(wpErpHr.confirm)&&wp.ajax.send(t.data("action"),{data:{id:t.data("id"),employee_id:t.data("employee_id"),_wpnonce:wpErpHr.nonce},success:function(){p.reloadPage()},error:function(e){alert(e)}})},selectResultType:function(e){"percentage"===i(this).val()?(i(".education-form-wrap #result_area label").html("Result (%) <span class='required'>*</span>"),i(".education-form-wrap #gpa").attr("placeholder","100"),i(".education-form-wrap #scale").removeAttr("required"),i(".education-form-wrap #result_scale").fadeOut()):(i(".education-form-wrap #result_area label").html("Result (Grade) <span class='required'>*</span>"),i(".education-form-wrap #gpa").attr("placeholder","5.0"),i(".education-form-wrap #scale").attr("required","required"),i(".education-form-wrap #result_scale").fadeIn())}},updateJobStatus:function(e){void 0!==e&&e.preventDefault();var t=i(this),o="",n="";wp.ajax.send({data:{id:i("#erp-empl-status").data("id"),action:"erp-hr-emp-get",_wpnonce:wpErpHr.nonce},success:function(e){o=e.work.status,n=e.work.type}}),i.erpPopup({title:t.data("title"),button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){var e=wp.template(t.data("template"))(window.wpErpCurrentEmployee);i(".content",this).html(e),p.initDateField()},onSubmit:function(e){var r=this.serializeObject();r.status?o==r.status?(e.closeModal(),swal("",wpErpHr.popup.already_selected,"error")):"terminated"==r.status?(e.closeModal(),i.erpPopup({title:t.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-terminate")({});i(".content",this).html(e),p.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){p.ajaxReq(r,t)},error:function(e){t.enableButton(),t.showError(e)}})}})):"active"==r.status?(e.closeModal(),i.erpPopup({title:wpErpHr.popup.employment_type,button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-type")(window.wpErpCurrentEmployee);i(".content",this).html(e),p.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){p.ajaxReq(r,t)},error:function(e){t.enableButton(),t.showError(e)}})}})):p.ajaxReq(r,e):r.type&&n==r.type?(e.closeModal(),swal("",wpErpHr.popup.already_selected,"error")):p.ajaxReq(r,e)}})},removeHistory:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send("erp-hr-emp-delete-history",{data:{history_id:i(this).data("id"),user_id:wpErpCurrentEmployee.user_id,_wpnonce:wpErpHr.nonce},success:function(){p.reloadPage()}})},printData:function(e){e.preventDefault(),window.print()},checkUserEmail:function(){var r=i(this),e=r.val(),t=r.closest("form").find("#erp-employee-id").val();return!(""==e||!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e))&&("0"==t&&void wp.ajax.send("erp_hr_check_user_exist",{data:{email:e,_wpnonce:wpErpHr.nonce},success:function(){var e=r.closest("form");e.find(".modal-suggession").fadeOut(300,function(){i(this).remove()}),e.find("button[type=submit]").removeAttr("disabled")},error:function(e){var t=r.closest("form");t.find("button[type=submit]").attr("disabled","disabled"),"employee"==e.type&&(t.find(".modal-suggession").remove(),t.find("header.modal-header").append('<div class="modal-suggession">'+wpErpHr.employee_exit+"</div>")),"wp_user"==e.type&&(t.find(".modal-suggession").remove(),t.find("header.modal-header").append('<div class="modal-suggession">'+wpErpHr.make_employee_text+' <a href="#" id="erp-hr-create-wp-user-to-employee" data-user_id="'+e.data.ID+'">'+wpErpHr.create_employee_text+"</a></div>")),i(".modal-suggession").hide().slideDown(function(){t.find(".content-container").css({marginTop:"15px"})})}}))},makeUserEmployee:function(e){e.preventDefault();var t=i(this),o=t.data("user_id");t.closest(".modal-suggession").append('<div class="erp-loader" style="top:9px; right:10px;"></div>'),wp.ajax.send("erp-hr-convert-wp-to-employee",{data:{user_id:o,_wpnonce:wpErpHr.nonce},success:function(){t.closest(".modal-suggession").find(".erp-loader").remove(),t.closest(".erp-modal").remove(),i(".erp-modal-backdrop").remove(),p.employee.reload(),i.erpPopup({title:wpErpHr.popup.employee_update,button:wpErpHr.popup.employee_update,id:"erp-employee-edit",onReady:function(){var r=this;i("header",r).after(i('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-emp-get",{data:{id:o,_wpnonce:wpErpHr.nonce},success:function(e){var t=wp.template("erp-new-employee")(e);i(".content",r).html(t),i(".loader",r).remove(),p.initDateField(),i("div[data-selected]",r).each(function(){var e=i(this),t=e.data("selected");""!==t&&e.find("select").val(t).trigger("change")}),i('#work_reporting_to option[value="'+e.id+'"]',r).attr("disabled","disabled")}})},onSubmit:function(t){t.disableButton(),wp.ajax.send({data:this.serialize(),success:function(e){p.employee.reload(),t.enableButton(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},error:function(e){alert(e)}})},addNote:function(e){e.preventDefault();var t=i(this),r=t.find("input[type=submit]");r.attr("disabled","disabled"),t.find(".erp-note-loader").show(),wp.ajax.send({data:t.serializeObject(),success:function(){i.get(window.location.href,function(e){i("ul.notes-list li").length<0?i("ul.notes-list").prepend(i(e).find("ul.notes-list").after()):i("ul.notes-list").prepend(i(e).find("ul.notes-list li").first()),10<i("ul.notes-list li").length&&i("ul.notes-list li").last().remove(),p.employee.showLoadMoreBtn(),t.find(".erp-note-loader").hide(),t.find("textarea").val(""),r.removeAttr("disabled")})},error:function(){r.removeAttr("disabled"),t.find(".erp-note-loader").hide()}})},showLoadMoreBtn:function(){10<=i("ul.notes-list li").length?i(".wperp-load-more-btn").show():i(".wperp-load-more-btn").hide()},loadNotes:function(e){e.preventDefault();var t=i(this),r={action:"erp-load-more-notes",user_id:t.data("user_id"),total_no:t.data("total_no"),offset_no:t.data("offset_no")};t.closest("p").append('<span class="erp-loader" style="margin:4px 0px 0px 10px"></span>').find(".erp-loader").show(),t.attr("disabled",!0),wp.ajax.send({data:r,success:function(e){t.data("offset_no",parseInt(r.total_no)+parseInt(r.offset_no)),i(e.content).appendTo(t.closest(".note-tab-wrap").find("ul.notes-list")).hide().fadeIn(),t.removeAttr("disabled"),i(".erp-loader").remove()},error:function(e){alert(e)}})},deleteNote:function(e){if(e.preventDefault(),confirm(wpErpHr.delConfirmEmployeeNote)){var t=i(this),r={action:"erp-delete-employee-note",note_id:t.data("note_id"),user_id:wpErpCurrentEmployee.user_id,_wpnonce:wpErpHr.nonce};wp.ajax.send({data:r,success:function(e){t.closest("li").fadeOut(400,function(){i(this).remove(),p.employee.showLoadMoreBtn()})},error:function(e){alert(e)}})}},updatePerformance:function(e){void 0!==e&&e.preventDefault();var t=i(this);i.erpPopup({title:t.data("title"),button:wpErpHr.popup.update_status,id:"erp-hr-update-performance",content:"",extraClass:"smaller",onReady:function(){var e=wp.template(t.data("template"))(window.wpErpCurrentEmployee);i(".content",this).html(e),p.initDateField(),p.employee.select2Action("erp-hrm-select2"),i(".row[data-selected]",this).each(function(){var e=i(this),t=e.data("selected");""!==t&&e.find("select").val(t)})},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){p.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},removePerformance:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send({data:{action:"erp-hr-emp-delete-performance",id:i(this).data("id"),user_id:i(this).data("userid"),_wpnonce:wpErpHr.nonce},success:function(){p.reloadPage()}})},terminateEmployee:function(e){void 0!==e&&e.preventDefault();var t=i(this);if(t.data("data"))var r=t.data("data");else r=window.wpErpCurrentEmployee;i.erpPopup({title:t.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template(t.data("template"))(r);i(".content",this).html(e),p.initDateField(),i(".row[data-selected]",this).each(function(){var e=i(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),p.employee.select2Action("erp-hrm-select2")},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){p.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},activateEmployee:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send({data:{action:"erp-hr-emp-activate",id:i(this).data("id"),_wpnonce:wpErpHr.nonce},success:function(){p.reloadPage()}})},changeEmployeeStatus:function(e){e.preventDefault();var r=(a=i(this)).closest("form"),t=r.find("select#erp-hr-employee-status-option"),o=t.val(),n=t.attr("data-selected");if("terminated"==o)o!=n?i.erpPopup({title:a.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-terminate")({});i(".content",this).html(e),p.initDateField(),p.employee.select2Action("erp-hrm-select2")},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){p.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}}):alert(wpErpHr.popup.already_terminate);else if("active"==o)if(o!=n){var a=i(this);i.erpPopup({title:wpErpHr.popup.employment_status,button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-type")(window.wpErpCurrentEmployee);i(".content",this).html(e),p.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){t.closeModal(),r.submit()},error:function(e){t.enableButton(),t.showError(e)}})}})}else alert(wpErpHr.popup.already_active);else r.submit()}}};i(function(){p.initialize()})}(jQuery);